!function(){function b(c){if(this===a)return new b(c);this.options={weekStart:1,weekdays:["su","mo","tu","we","th","fr","sa"],months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],buttons:{next:"Next",prev:"Prev",close:"x"},date:new Date,dateFormat:"y/m/d",floatingOverlay:!1},this._events={},this._elms={},c&&C(c).keys().each(function(a){this.options[a]=c[a]},this),C(this).bindAll("nextMonth","prevMonth","dateCellClicked")}function c(a,b){if(typeof b!="function")throw new Error("Second argument needs to be a function");return this._events[a]||(this._events[a]=[]),this._events[a].push(b),this}function d(a,b){if(!this._events[a])return;var c;while((c=this._events[a].indexOf(b))>-1)this._events[a].splice(c,1);return this}function e(a){var b=this._events[a],c=Array.prototype.slice.call(arguments,1);return b&&C(b).each(function(a){a.apply(null,c)}),this}function f(a){var b=a.target,c=b.dataset.date,d=this.options.dateFormat;if(!c)return;c=c.split("/"),this.options.date.setFullYear(c[0]),this.options.date.setMonth(c[1]-1),this.options.date.setDate(c[2]),this._elms.input&&(this._elms.input.value=z(this.options.date,d)),this._visibleDate=this.options.date,this.emit("change",this.options.date,this);if(this._elms.floater){this.hide();return}this.rerender()}function g(){this._visibleDate.setDate(1),this._visibleDate.setMonth(this._visibleDate.getMonth()+1),this.rerender()}function h(){this._visibleDate.setDate(1),this._visibleDate.setMonth(this._visibleDate.getMonth()-1),this.rerender()}function i(){if(!this.container)return this;var a=this.render();return this.container.innerHTML="",this.container.appendChild(a),this}function j(){var a=document.createDocumentFragment(),b=this._visibleDate||this.options.date,c=this._elms.floater&&this.options.floatingOverlay?A("div",{className:"fzk-dp-overlay"}):null,d=!!this._elms.floater,e=C(this.hide).bind(this);return this._visibleDate||(this._visibleDate=new Date(b.getTime())),c&&a.appendChild(c),a.appendChild(this.renderControls(d)),a.appendChild(this.renderHeaderLabels()),a.appendChild(this.renderDateCells()),c&&(c.onclick=e),d&&(E(".fzk-dp-btn-cls",a).onclick=e),E(".fzk-dp-btn-nxt",a).onclick=this.nextMonth,E(".fzk-dp-btn-prv",a).onclick=this.prevMonth,E(".fzk-dp-cells",a).onclick=this.dateCellClicked,a}function k(a){var b=A("div",{className:"fzk-dp-ctrls"}),c=this._visibleDate;return b.appendChild(A("label",{className:"fzk-dp-month",innerHTML:this.options.months[c.getMonth()]+" "+c.getFullYear()})),b.appendChild(A("button",{className:"fzk-dp-btn-prv",innerHTML:this.options.buttons.prev})),b.appendChild(A("button",{className:"fzk-dp-btn-nxt",innerHTML:this.options.buttons.next})),a&&b.appendChild(A("button",{className:"fzk-dp-btn-cls",innerHTML:this.options.buttons.close})),b}function l(){var a=A("div",{className:"fzk-dp-lbls"});return C(n(this.options)).each(function(b){a.appendChild(A("label",{className:"fzk-dp-cell",innerHTML:b}))}),a}function m(){function h(b){return function(c){var d={className:"fzk-dp-cell "+b,innerHTML:c.date},f={date:c.fullDate};g===c.fullDate&&(d.className+=" fzk-dp-cell-today"),e===c.fullDate&&(d.className+=" fzk-dp-cell-current"),a.appendChild(A("span",d,f))}}var a=A("div",{className:"fzk-dp-cells"}),b=this._visibleDate,c=b.getFullYear()+"/"+r(b.getMonth()+1)+"/"+r(b.getDate()),d=this.options.date,e=d.getFullYear()+"/"+r(d.getMonth()+1)+"/"+r(d.getDate()),f=new Date,g=f.getFullYear()+"/"+r(f.getMonth()+1)+"/"+r(f.getDate());return C(p(b,this.options)).each(h("fzk-dp-cell-prv")),C(o(b)).each(h("")),C(q(b,this.options)).each(h("fzk-dp-cell-nxt")),a}function n(a){var b=[],c,d=a.weekStart;for(c=0;c<7;c++)b[c]=a.weekdays[d++],d==7&&(d=0);return b}function o(a,b){var c=a.getFullYear(),d=r(a.getMonth()+1),e=a.getDate(),f=(new Date(c,+d,0)).getDate(),g=[],h;for(h=1;h<=f;h++){var i=r(h);g.push({date:i,fullDate:c+"/"+d+"/"+i,current:e===h})}return g}function p(a,b){var c=new Date(a.getFullYear(),a.getMonth(),1);if(c.getDay()==b.weekStart)return[];var d=new Date(a.getFullYear(),a.getMonth(),0),e=d.getFullYear(),f=r(d.getMonth()+1),g=d.getDate(),h=c.getDay(),i=[],j,k=h-b.weekStart;k<0&&(k+=7);for(j=0;j<k;j++){var l=(g-k+j+1).toString();i.push({date:l,fullDate:e+"/"+f+"/"+l})}return i}function q(a,b){var c=new Date(a.getFullYear(),a.getMonth()+1,1);if(c.getDay()==b.weekStart)return[];var d=c.getFullYear(),e=r(c.getMonth()+1),f=[],g=c.getDay()-b.weekStart,h=7,i=1;g<0&&(g+=7);for(;g<h;g++){var j=r(i++);f.push({date:j,fullDate:d+"/"+e+"/"+j})}return f}function r(a){return a=+a,a<10?"0"+a:a.toString()}function s(a){return this.resolveSelector(a||this.selector||this.options.elm),this._elms.input&&(this.options.date=y(this._elms.input.value)||this.options.date),this._visibleDate||(this._visibleDate=new Date(this.options.date.getTime())),B(this.container,"fzk-dp"),this.rerender(),this.showing=!0,this.emit("show",this)}function t(){return this.container.innerHTML="",this._removeFloater(),this.showing=!1,this._visibleDate=null,this.selector=null,this.emit("hide",this)}function u(a){return this.showing&&(!a||this.selector===a)?this.hide():this.show(a)}function v(){this._elms.floater&&(this._elms.floater.parentNode.removeChild(this._elms.floater),this._elms.floater=null)}function w(a){this.container=typeof a=="string"?E(a):a;if(!this.container)throw new Error('"'+a+'" does not resolve to an element!');this.selector=a,this.container.tagName.toLowerCase()==="input"&&(this._elms.input=this.container),this._removeFloater();if(this._elms.input){this._elms.input.value&&(this._visibleDate=null,this.options.date=b.parseDate(this._elms.input.value,this.options.dateFormat)),this._elms.floater=this.container=A("div",{className:"fzk-dp-float"}),document.body.appendChild(this._elms.floater);var c=x(this._elms.input);this.container.style.left=c.left+"px",this.container.style.top=c.top+c.height+"px"}}function x(a){var b=a.getBoundingClientRect(),c=a.ownerDocument,d=c.body,e=c.documentElement,f={top:e.scrollTop||d.scrollTop,left:e.scrollLeft||d.scrollLeft},g={top:e.clientTop||d.clientTop||0,left:e.clientLeft||d.clientLeft||0};return{top:b.top+f.top-g.top,left:b.left+f.left-g.left,width:b.width,height:b.height}}function y(a,b){function h(a){return c[e[a]]=d++,"(\\d+)"}if(!a)return null;b||(b="y/m/d");var c={},d=1,e={m:"month",M:"month",d:"day",D:"day",y:"year",Y:"year"},f=new RegExp(b.replace(/[yYdDmM]/g,h)),g=a.match(f);return!g||g.length!=4||!c.day||!c.month||!c.year?null:(g[c.year].length==2&&(g[c.year]=(g[c.year]<25?"20":"19")+g[c.year]),new Date(g[c.year],g[c.month]-1,g[c.day]))}function z(a,b){return b.replace(/([YyMmDd])/g,function(b){switch(b){case"d":return r(a.getDate());case"D":return a.getDate();case"m":return r(a.getMonth()+1);case"M":return a.getMonth()+1;case"y":return a.getFullYear();case"Y":return a.getFullYear().toString().substring(2)}})}function A(a,b,c){var d=document.createElement(a);return b&&C(b).keys().each(function(a){d[a]=b[a]}),c&&C(c).keys().each(function(a){d.dataset[a]=c[a]}),d}function B(a,b){(new RegExp("(^| )"+b+"($| )")).test(a.className)||(a.className+=" "+b)}function C(a){function b(){var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(c);return C(b)}function c(b){return function(){return a.apply(b,arguments)}}function d(b){b=Array.prototype.slice.call(arguments),C(b).each(function(b){a[b]=C(a[b]).bind(a)})}function e(b,c){var d=0,e=a.length;for(;d<e;d++)b.call(c,a[d],d,a)}return{bind:c,bindAll:d,keys:b,each:e}}function D(a,b){return Array.prototype.slice.call((b||document).querySelectorAll(a))}function E(a,b){return(b||document).querySelector(a)}var a=this;a.DatePicker=b,b.VERSION="0.4.0",b.prototype={show:s,hide:t,toggle:u,render:j,on:c,off:d,emit:e,trigger:e,resolveSelector:w,rerender:i,renderControls:k,renderHeaderLabels:l,renderDateCells:m,nextMonth:g,prevMonth:h,dateCellClicked:f,_removeFloater:v},b.getCurrentMonth=o,b.getOverflowNext=q,b.getOverflowPrev=p,b.parseDate=y,b.formatDate=z}();